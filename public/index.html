<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GenLayer Polymarket Benchmark</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0d1117;
      color: #c9d1d9;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container { max-width: 1400px; margin: 0 auto; }
    
    header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #30363d;
    }
    
    h1 { color: #58a6ff; font-size: 2rem; margin-bottom: 10px; }
    .subtitle { color: #8b949e; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 20px;
    }
    
    .stat-value { font-size: 2rem; font-weight: bold; color: #58a6ff; }
    .stat-label { color: #8b949e; font-size: 0.9rem; margin-top: 5px; }
    
    .section {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    
    .section-header {
      background: #21262d;
      padding: 15px 20px;
      font-weight: 600;
      border-bottom: 1px solid #30363d;
    }
    
    .filters {
      padding: 15px 20px;
      background: #161b22;
      border-bottom: 1px solid #30363d;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .filter-group label {
      display: block;
      font-size: 0.8rem;
      color: #8b949e;
      margin-bottom: 5px;
    }
    
    select, input {
      background: #0d1117;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 8px 12px;
      color: #c9d1d9;
      font-size: 0.9rem;
    }
    
    .markets-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .markets-table th {
      text-align: left;
      padding: 12px 15px;
      background: #21262d;
      border-bottom: 1px solid #30363d;
      font-weight: 600;
      font-size: 0.85rem;
      color: #8b949e;
    }
    
    .markets-table td {
      padding: 12px 15px;
      border-bottom: 1px solid #30363d;
      font-size: 0.9rem;
    }
    
    .markets-table tr:hover { background: #21262d; }
    
    .question-cell {
      max-width: 400px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .outcome-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .outcome-yes { background: #238636; color: #fff; }
    .outcome-no { background: #da3633; color: #fff; }
    .outcome-other { background: #9e6a03; color: #fff; }
    
    .category-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 0.75rem;
      background: #30363d;
    }
    
    .url-cell {
      max-width: 250px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .url-cell a { color: #58a6ff; text-decoration: none; }
    .url-cell a:hover { text-decoration: underline; }
    
    .no-url { color: #8b949e; font-style: italic; }
    
    .source-type {
      font-size: 0.75rem;
      padding: 2px 6px;
      border-radius: 3px;
      background: #30363d;
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 20px;
    }
    
    .pagination button {
      background: #21262d;
      border: 1px solid #30363d;
      border-radius: 6px;
      padding: 8px 16px;
      color: #c9d1d9;
      cursor: pointer;
    }
    
    .pagination button:hover { background: #30363d; }
    .pagination button:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #8b949e;
    }
    
    .breakdown-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    
    .breakdown-section h3 {
      font-size: 0.9rem;
      color: #8b949e;
      margin-bottom: 10px;
    }
    
    .breakdown-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #21262d;
    }
    
    .breakdown-bar {
      height: 6px;
      background: #30363d;
      border-radius: 3px;
      margin-top: 5px;
      overflow: hidden;
    }
    
    .breakdown-fill {
      height: 100%;
      background: #58a6ff;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üî¨ GenLayer ‚Üî Polymarket Benchmark</h1>
      <p class="subtitle">100 Resolved Polymarket Markets Sample</p>
    </header>
    
    <div id="loading" class="loading">Loading markets data...</div>
    
    <div id="content" style="display: none;">
      <div class="stats-grid" id="stats"></div>
      
      <div class="section">
        <div class="section-header">üìä Breakdown</div>
        <div class="breakdown-grid" id="breakdown"></div>
      </div>
      
      <div class="section">
        <div class="section-header">üìã Markets Sample</div>
        <div class="filters">
          <div class="filter-group">
            <label>Category</label>
            <select id="filter-category">
              <option value="">All Categories</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Resolution Source</label>
            <select id="filter-source">
              <option value="">All Sources</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Has URL</label>
            <select id="filter-url">
              <option value="">All</option>
              <option value="yes">With URL</option>
              <option value="no">Without URL</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Search</label>
            <input type="text" id="search" placeholder="Search questions...">
          </div>
        </div>
        <div style="overflow-x: auto;">
          <table class="markets-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Question</th>
                <th>Outcome</th>
                <th>Category</th>
                <th>Resolution URL</th>
                <th>Source Type</th>
                <th>End Date</th>
              </tr>
            </thead>
            <tbody id="markets-body"></tbody>
          </table>
        </div>
        <div class="pagination" id="pagination"></div>
      </div>
    </div>
  </div>
  
  <script>
    let data = null;
    let filteredMarkets = [];
    let currentPage = 1;
    const pageSize = 20;
    
    async function loadData() {
      try {
        const response = await fetch('/api/markets');
        data = await response.json();
        filteredMarkets = data.markets;
        
        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';
        
        renderStats();
        renderBreakdown();
        populateFilters();
        renderMarkets();
      } catch (err) {
        document.getElementById('loading').textContent = 'Failed to load data: ' + err.message;
      }
    }
    
    function renderStats() {
      const stats = data.stats;
      document.getElementById('stats').innerHTML = `
        <div class="stat-card">
          <div class="stat-value">${stats.total}</div>
          <div class="stat-label">Total Markets</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${stats.with_url}</div>
          <div class="stat-label">With Resolution URL</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${stats.without_url}</div>
          <div class="stat-label">Without URL</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">${Math.round(stats.with_url / stats.total * 100)}%</div>
          <div class="stat-label">URL Coverage</div>
        </div>
      `;
    }
    
    function renderBreakdown() {
      const stats = data.stats;
      
      const categoryHtml = Object.entries(stats.by_category)
        .sort((a, b) => b[1] - a[1])
        .map(([cat, count]) => `
          <div class="breakdown-item">
            <span>${cat}</span>
            <span>${count}</span>
          </div>
          <div class="breakdown-bar">
            <div class="breakdown-fill" style="width: ${count / stats.total * 100}%"></div>
          </div>
        `).join('');
      
      const sourceHtml = Object.entries(stats.by_source_type)
        .sort((a, b) => b[1] - a[1])
        .map(([type, count]) => `
          <div class="breakdown-item">
            <span>${type}</span>
            <span>${count}</span>
          </div>
          <div class="breakdown-bar">
            <div class="breakdown-fill" style="width: ${count / stats.total * 100}%"></div>
          </div>
        `).join('');
      
      document.getElementById('breakdown').innerHTML = `
        <div class="breakdown-section">
          <h3>By Category</h3>
          ${categoryHtml}
        </div>
        <div class="breakdown-section">
          <h3>By Resolution Source Type</h3>
          ${sourceHtml}
        </div>
        <div class="breakdown-section">
          <h3>Date Range</h3>
          <div class="breakdown-item">
            <span>Earliest</span>
            <span>${stats.date_range.earliest.split('T')[0]}</span>
          </div>
          <div class="breakdown-item">
            <span>Latest</span>
            <span>${stats.date_range.latest.split('T')[0]}</span>
          </div>
        </div>
      `;
    }
    
    function populateFilters() {
      const categories = [...new Set(data.markets.map(m => m.category))].sort();
      const sources = [...new Set(data.markets.map(m => m.resolution_source_type))].sort();
      
      document.getElementById('filter-category').innerHTML = 
        '<option value="">All Categories</option>' +
        categories.map(c => `<option value="${c}">${c}</option>`).join('');
      
      document.getElementById('filter-source').innerHTML = 
        '<option value="">All Sources</option>' +
        sources.map(s => `<option value="${s}">${s}</option>`).join('');
    }
    
    function applyFilters() {
      const category = document.getElementById('filter-category').value;
      const source = document.getElementById('filter-source').value;
      const hasUrl = document.getElementById('filter-url').value;
      const search = document.getElementById('search').value.toLowerCase();
      
      filteredMarkets = data.markets.filter(m => {
        if (category && m.category !== category) return false;
        if (source && m.resolution_source_type !== source) return false;
        if (hasUrl === 'yes' && !m.resolution_url) return false;
        if (hasUrl === 'no' && m.resolution_url) return false;
        if (search && !m.question.toLowerCase().includes(search)) return false;
        return true;
      });
      
      currentPage = 1;
      renderMarkets();
    }
    
    function renderMarkets() {
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageMarkets = filteredMarkets.slice(start, end);
      
      const tbody = document.getElementById('markets-body');
      tbody.innerHTML = pageMarkets.map((m, i) => {
        const outcomeClass = m.outcome.toLowerCase() === 'yes' ? 'outcome-yes' : 
                            m.outcome.toLowerCase() === 'no' ? 'outcome-no' : 'outcome-other';
        
        return `
          <tr>
            <td>${start + i + 1}</td>
            <td class="question-cell" title="${m.question}">${m.question}</td>
            <td><span class="outcome-badge ${outcomeClass}">${m.outcome}</span></td>
            <td><span class="category-badge">${m.category}</span></td>
            <td class="url-cell">
              ${m.resolution_url 
                ? `<a href="${m.resolution_url}" target="_blank">${m.resolution_url}</a>`
                : '<span class="no-url">None</span>'}
            </td>
            <td><span class="source-type">${m.resolution_source_type}</span></td>
            <td>${m.end_date ? m.end_date.split('T')[0] : '-'}</td>
          </tr>
        `;
      }).join('');
      
      renderPagination();
    }
    
    function renderPagination() {
      const totalPages = Math.ceil(filteredMarkets.length / pageSize);
      document.getElementById('pagination').innerHTML = `
        <button onclick="changePage(-1)" ${currentPage === 1 ? 'disabled' : ''}>‚Üê Previous</button>
        <span>Page ${currentPage} of ${totalPages} (${filteredMarkets.length} markets)</span>
        <button onclick="changePage(1)" ${currentPage === totalPages ? 'disabled' : ''}>Next ‚Üí</button>
      `;
    }
    
    function changePage(delta) {
      currentPage += delta;
      renderMarkets();
    }
    
    // Event listeners
    document.getElementById('filter-category').addEventListener('change', applyFilters);
    document.getElementById('filter-source').addEventListener('change', applyFilters);
    document.getElementById('filter-url').addEventListener('change', applyFilters);
    document.getElementById('search').addEventListener('input', applyFilters);
    
    // Load data
    loadData();
  </script>
</body>
</html>
